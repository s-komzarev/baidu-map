import { isMapTypeEnum } from '../types/Map';
import { isNull } from './object';
export function toPoint(opts) {
    if (!opts) {
        return new window.BMap.Point();
    }
    return new window.BMap.Point(opts.lng, opts.lat);
}
export function toPoints(opts) {
    if (!opts) {
        return [];
    }
    return opts.map(function (p) {
        return new window.BMap.Point(p.lng, p.lat);
    });
}
export function toSize(opts) {
    if (!opts) {
        return new window.BMap.Size();
    }
    return new window.BMap.Size(opts.width, opts.height);
}
export function toIcon(url, size, options) {
    if (!size && !options) {
        return new window.BMap.Icon(url);
    }
    if (!size) {
        return new window.BMap.Icon(url, toSize(size));
    }
    var iconOptions = {
        anchor: toSize(options.anchor),
        imageOffset: toSize(options.imageOffset),
        infoWindowAnchor: toSize(options.infoWindowAnchor),
        printImageUrl: options.printImageUrl
    };
    var icon = new window.BMap.Icon(url, toSize(size), iconOptions);
    if (options.imageSize) {
        icon.setImageSize(toSize(options.imageSize));
    }
    return icon;
}
export function toMarkerOptions(options) {
    var opts = {};
    if (!options) {
        return opts;
    }
    if (options.offset) {
        opts.offset = toSize(options.offset);
    }
    if (options.icon) {
        opts.icon = toIcon(options.icon.imageUrl, options.icon.size, options.icon);
    }
    if (!isNull(options.enableMassClear)) {
        opts.enableMassClear = options.enableMassClear;
    }
    if (!isNull(options.enableDragging)) {
        opts.enableDragging = options.enableDragging;
    }
    if (!isNull(options.enableClicking)) {
        opts.enableClicking = options.enableClicking;
    }
    if (!isNull(options.raiseOnDrag)) {
        opts.raiseOnDrag = options.raiseOnDrag;
    }
    if (!isNull(options.draggingCursor)) {
        opts.draggingCursor = options.draggingCursor;
    }
    if (!isNull(options.rotation)) {
        opts.rotation = options.rotation;
    }
    if (!isNull(options.title)) {
        opts.title = options.title;
    }
    if (!isNull(options.shadow)) {
        opts.shadow = toIcon(options.shadow.imageUrl, options.shadow.size, options.shadow);
    }
    return opts;
}
export function toNavigationControlOptions(options) {
    var opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.enableGeolocation)) {
        opts.enableGeolocation = options.enableGeolocation;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    if (!isNull(options.showZoomInfo)) {
        opts.showZoomInfo = options.showZoomInfo;
    }
    if (!isNull(options.type)) {
        opts.type = options.type;
    }
    return opts;
}
export function toOverviewMapControlOptions(options) {
    var opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.isOpen)) {
        opts.isOpen = options.isOpen;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    if (!isNull(options.size)) {
        opts.size = toSize(options.size);
    }
    return opts;
}
export function toScaleControlOptions(options) {
    var opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    return opts;
}
export function toMapTypeControlOptions(options) {
    var opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.type)) {
        opts.type = options.type;
    }
    if (!isNull(options.mapTypes)) {
        opts.mapTypes = options.mapTypes.map(function (mapType) {
            return isMapTypeEnum(mapType) ? window[mapType] : mapType;
        });
    }
    return opts;
}
export function toGeolocationOptions(options) {
    var opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    if (!isNull(options.enableAutoLocation)) {
        opts.enableAutoLocation = options.enableAutoLocation;
    }
    if (!isNull(options.locationIcon)) {
        opts.locationIcon = toIcon(options.locationIcon.imageUrl, options.locationIcon.size, options.locationIcon);
    }
    if (!isNull(options.showAddressBar)) {
        opts.showAddressBar = options.showAddressBar;
    }
    return opts;
}
export function toTextIconStyle(style) {
    var realStyle = {
        url: style.url,
        size: toSize(style.size)
    };
    if (style.anchor) {
        realStyle.anchor = toSize(style.anchor);
    }
    if (style.offset) {
        realStyle.offset = toSize(style.offset);
    }
    if (!isNull(style.textSize)) {
        realStyle.textSize = style.textSize;
    }
    if (!isNull(style.textColor)) {
        realStyle.textColor = style.textColor;
    }
    return realStyle;
}
export function toMarkerClustererOptions(options) {
    var opts = {};
    if (!options) {
        return opts;
    }
    if (options.markers) {
        opts.markers = options.markers.map(function (m) { return new window.BMap.Marker(toPoint(m.point), toMarkerOptions(m.options)); });
    }
    if (!isNull(options.girdSize)) {
        opts.girdSize = options.girdSize;
    }
    if (!isNull(options.maxZoom)) {
        opts.maxZoom = options.maxZoom;
    }
    if (!isNull(options.minClusterSize)) {
        opts.minClusterSize = options.minClusterSize;
    }
    if (!isNull(options.isAverangeCenter)) {
        opts.isAverangeCenter = options.isAverangeCenter;
    }
    if (options.styles) {
        opts.styles = options.styles.filter(function (s) { return s; }).map(function (s) { return toTextIconStyle(s); });
    }
    return opts;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyMi1iYWlkdS1tYXAvIiwic291cmNlcyI6WyJsaWIvaGVscGVycy90cmFuc2Zvcm1lci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFnQkEsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGNBQWMsQ0FBQTtBQUU1QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBSWpDLE1BQU0sVUFBVSxPQUFPLENBQUMsSUFBVztJQUNqQyxJQUFJLENBQUMsSUFBSSxFQUFFO1FBQ1QsT0FBTyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUE7S0FDL0I7SUFDRCxPQUFPLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDbEQsQ0FBQztBQUVELE1BQU0sVUFBVSxRQUFRLENBQUMsSUFBa0I7SUFDekMsSUFBSSxDQUFDLElBQUksRUFBRTtRQUNULE9BQU8sRUFBRSxDQUFBO0tBQ1Y7SUFDRCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBQSxDQUFDO1FBQ2YsT0FBTyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQzVDLENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxNQUFNLENBQUMsSUFBVTtJQUMvQixJQUFJLENBQUMsSUFBSSxFQUFFO1FBQ1QsT0FBTyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUE7S0FDOUI7SUFDRCxPQUFPLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7QUFDdEQsQ0FBQztBQUVELE1B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QUEsQ0FBQyxFQUFELENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLGVBQWUsQ0FBQyxDQUFDLENBQUMsRUFBbEIsQ0FBa0IsQ0FBQyxDQUFBO0tBQ3pFO0lBRUQsT0FBTyxJQUFJLENBQUE7QUFDYixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBCR2VvbG9jYXRpb25Db250cm9sT3B0aW9ucyxcclxuICBCTWFwVHlwZUNvbnRyb2xPcHRpb25zLFxyXG4gIEJOYXZpZ2F0aW9uQ29udHJvbE9wdGlvbnMsXHJcbiAgQk92ZXJ2aWV3TWFwQ29udHJvbE9wdGlvbnMsXHJcbiAgQlNjYWxlQ29udHJvbE9wdGlvbnMsXHJcbiAgR2VvbG9jYXRpb25Db250cm9sT3B0aW9ucyxcclxuICBNYXBUeXBlQ29udHJvbE9wdGlvbnMsXHJcbiAgTmF2aWdhdGlvbkNvbnRyb2xPcHRpb25zLFxyXG4gIE92ZXJ2aWV3TWFwQ29udHJvbE9wdGlvbnMsXHJcbiAgU2NhbGVDb250cm9sT3B0aW9uc1xyXG59IGZyb20gJy4uL3R5cGVzL0NvbnRyb2wnXHJcbmltcG9ydCB7IEJJY29uLCBJY29uT3B0aW9ucyB9IGZyb20gJy4uL3R5cGVzL0ljb24nXHJcbmltcG9ydCB7IEJNYXJrZXJPcHRpb25zLCBNYXJrZXJPcHRpb25zIH0gZnJvbSAnLi4vdHlwZXMvTWFya2VyJ1xyXG5pbXBvcnQgeyBCUG9pbnQsIFBvaW50IH0gZnJvbSAnLi4vdHlwZXMvUG9pbnQnXHJcbmltcG9ydCB7IEJTaXplLCBTaXplIH0gZnJvbSAnLi4vdHlwZXMvU2l6ZSdcclxuaW1wb3J0IHsgaXNNYXBUeXBlRW51bSB9IGZyb20gJy4uL3R5cGVzL01hcCdcclxuXHJcbmltcG9ydCB7IGlzTnVsbCB9IGZyb20gJy4vb2JqZWN0J1xyXG5pbXBvcnQgeyBCTWFya2VyQ2x1c3RlcmVyT3B0aW9ucywgTWFya2VyQ2x1c3RlcmVyT3B0aW9ucyB9IGZyb20gJy4uL3R5cGVzL01hcmtlckNsdXN0ZXJlcidcclxuaW1wb3J0IHsgVGV4dEljb25TdHlsZSwgQlRleHRJY29uU3R5bGUgfSBmcm9tICcuLi90eXBlcy9UZXh0SWNvbk92ZXJsYXknXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9Qb2ludChvcHRzOiBQb2ludCk6IEJQb2ludCB7XHJcbiAgaWYgKCFvcHRzKSB7XHJcbiAgICByZXR1cm4gbmV3IHdpbmRvdy5CTWFwLlBvaW50KClcclxuICB9XHJcbiAgcmV0dXJuIG5ldyB3aW5kb3cuQk1hcC5Qb2ludChvcHRzLmxuZywgb3B0cy5sYXQpXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b1BvaW50cyhvcHRzOiBBcnJheTxQb2ludD4pOiBBcnJheTxCUG9pbnQ+IHtcclxuICBpZiAoIW9wdHMpIHtcclxuICAgIHJldHVybiBbXVxyXG4gIH1cclxuICByZXR1cm4gb3B0cy5tYXAocCA9PiB7XHJcbiAgICByZXR1cm4gbmV3IHdpbmRvdy5CTWFwLlBvaW50KHAubG5nLCBwLmxhdClcclxuICB9KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9TaXplKG9wdHM6IFNpemUpOiBCU2l6ZSB7XHJcbiAgaWYgKCFvcHRzKSB7XHJcbiAgICByZXR1cm4gbmV3IHdpbmRvdy5CTWFwLlNpemUoKVxyXG4gIH1cclxuICByZXR1cm4gbmV3IHdpbmRvdy5CTWFwLlNpemUob3B0cy53aWR0aCwgb3B0cy5oZWlnaHQpXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b0ljb24odXJsOiBzdHJpbmcsIHNpemU6IFNpemUsIG9wdGlvbnM6IEljb25PcHRpb25zKTogQkljb24ge1xyXG4gIGlmICghc2l6ZSAmJiAhb3B0aW9ucykge1xyXG4gICAgcmV0dXJuIG5ldyB3aW5kb3cuQk1hcC5JY29uKHVybClcclxuICB9XHJcbiAgaWYgKCFzaXplKSB7XHJcbiAgICByZXR1cm4gbmV3IHdpbmRvdy5CTWFwLkljb24odXJsLCB0b1NpemUoc2l6ZSkpXHJcbiAgfVxyXG4gIGNvbnN0IGljb25PcHRpb25zOiBhbnkgPSB7XHJcbiAgICBhbmNob3I6IHRvU2l6ZShvcHRpb25zLmFuY2hvciksXHJcbiAgICBpbWFnZU9mZnNldDogdG9TaXplKG9wdGlvbnMuaW1hZ2VPZmZzZXQpLFxyXG4gICAgaW5mb1dpbmRvd0FuY2hvcjogdG9TaXplKG9wdGlvbnMuaW5mb1dpbmRvd0FuY2hvciksXHJcbiAgICBwcmludEltYWdlVXJsOiBvcHRpb25zLnByaW50SW1hZ2VVcmxcclxuICB9XHJcbiAgY29uc3QgaWNvbiA9IG5ldyB3aW5kb3cuQk1hcC5JY29uKHVybCwgdG9TaXplKHNpemUpLCBpY29uT3B0aW9ucylcclxuICBpZiAob3B0aW9ucy5pbWFnZVNpemUpIHtcclxuICAgIGljb24uc2V0SW1hZ2VTaXplKHRvU2l6ZShvcHRpb25zLmltYWdlU2l6ZSkpXHJcbiAgfVxyXG4gIHJldHVybiBpY29uXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b01hcmtlck9wdGlvbnMob3B0aW9uczogTWFya2VyT3B0aW9ucyk6IEJNYXJrZXJPcHRpb25zIHtcclxuICBjb25zdCBvcHRzOiBCTWFya2VyT3B0aW9ucyA9IHt9XHJcblxyXG4gIGlmICghb3B0aW9ucykge1xyXG4gICAgcmV0dXJuIG9wdHNcclxuICB9XHJcblxyXG4gIGlmIChvcHRpb25zLm9mZnNldCkge1xyXG4gICAgb3B0cy5vZmZzZXQgPSB0b1NpemUob3B0aW9ucy5vZmZzZXQpXHJcbiAgfVxyXG5cclxuICBpZiAob3B0aW9ucy5pY29uKSB7XHJcbiAgICBvcHRzLmljb24gPSB0b0ljb24ob3B0aW9ucy5pY29uLmltYWdlVXJsLCBvcHRpb25zLmljb24uc2l6ZSwgb3B0aW9ucy5pY29uKVxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLmVuYWJsZU1hc3NDbGVhcikpIHtcclxuICAgIG9wdHMuZW5hYmxlTWFzc0NsZWFyID0gb3B0aW9ucy5lbmFibGVNYXNzQ2xlYXJcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5lbmFibGVEcmFnZ2luZykpIHtcclxuICAgIG9wdHMuZW5hYmxlRHJhZ2dpbmcgPSBvcHRpb25zLmVuYWJsZURyYWdnaW5nXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMuZW5hYmxlQ2xpY2tpbmcpKSB7XHJcbiAgICBvcHRzLmVuYWJsZUNsaWNraW5nID0gb3B0aW9ucy5lbmFibGVDbGlja2luZ1xyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLnJhaXNlT25EcmFnKSkge1xyXG4gICAgb3B0cy5yYWlzZU9uRHJhZyA9IG9wdGlvbnMucmFpc2VPbkRyYWdcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5kcmFnZ2luZ0N1cnNvcikpIHtcclxuICAgIG9wdHMuZHJhZ2dpbmdDdXJzb3IgPSBvcHRpb25zLmRyYWdnaW5nQ3Vyc29yXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMucm90YXRpb24pKSB7XHJcbiAgICBvcHRzLnJvdGF0aW9uID0gb3B0aW9ucy5yb3RhdGlvblxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLnRpdGxlKSkge1xyXG4gICAgb3B0cy50aXRsZSA9IG9wdGlvbnMudGl0bGVcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5zaGFkb3cpKSB7XHJcbiAgICBvcHRzLnNoYWRvdyA9IHRvSWNvbihvcHRpb25zLnNoYWRvdy5pbWFnZVVybCwgb3B0aW9ucy5zaGFkb3cuc2l6ZSwgb3B0aW9ucy5zaGFkb3cpXHJcbiAgfVxyXG5cclxuICByZXR1cm4gb3B0c1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9OYXZpZ2F0aW9uQ29udHJvbE9wdGlvbnMob3B0aW9uczogTmF2aWdhdGlvbkNvbnRyb2xPcHRpb25zKTogQk5hdmlnYXRpb25Db250cm9sT3B0aW9ucyB7XHJcbiAgY29uc3Qgb3B0czogQk5hdmlnYXRpb25Db250cm9sT3B0aW9ucyA9IHt9XHJcblxyXG4gIGlmICghb3B0aW9ucykge1xyXG4gICAgcmV0dXJuIG9wdHNcclxuICB9XHJcblxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMuYW5jaG9yKSkge1xyXG4gICAgb3B0cy5hbmNob3IgPSBvcHRpb25zLmFuY2hvclxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLmVuYWJsZUdlb2xvY2F0aW9uKSkge1xyXG4gICAgb3B0cy5lbmFibGVHZW9sb2NhdGlvbiA9IG9wdGlvbnMuZW5hYmxlR2VvbG9jYXRpb25cclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5vZmZzZXQpKSB7XHJcbiAgICBvcHRzLm9mZnNldCA9IHRvU2l6ZShvcHRpb25zLm9mZnNldClcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5zaG93Wm9vbUluZm8pKSB7XHJcbiAgICBvcHRzLnNob3dab29tSW5mbyA9IG9wdGlvbnMuc2hvd1pvb21JbmZvXHJcbiAgfVxyXG5cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLnR5cGUpKSB7XHJcbiAgICBvcHRzLnR5cGUgPSBvcHRpb25zLnR5cGVcclxuICB9XHJcbiAgcmV0dXJuIG9wdHNcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvT3ZlcnZpZXdNYXBDb250cm9sT3B0aW9ucyhvcHRpb25zOiBPdmVydmlld01hcENvbnRyb2xPcHRpb25zKTogQk92ZXJ2aWV3TWFwQ29udHJvbE9wdGlvbnMge1xyXG4gIGNvbnN0IG9wdHM6IEJPdmVydmlld01hcENvbnRyb2xPcHRpb25zID0ge31cclxuXHJcbiAgaWYgKCFvcHRpb25zKSB7XHJcbiAgICByZXR1cm4gb3B0c1xyXG4gIH1cclxuXHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5hbmNob3IpKSB7XHJcbiAgICBvcHRzLmFuY2hvciA9IG9wdGlvbnMuYW5jaG9yXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMuaXNPcGVuKSkge1xyXG4gICAgb3B0cy5pc09wZW4gPSBvcHRpb25zLmlzT3BlblxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLm9mZnNldCkpIHtcclxuICAgIG9wdHMub2Zmc2V0ID0gdG9TaXplKG9wdGlvbnMub2Zmc2V0KVxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLnNpemUpKSB7XHJcbiAgICBvcHRzLnNpemUgPSB0b1NpemUob3B0aW9ucy5zaXplKVxyXG4gIH1cclxuICByZXR1cm4gb3B0c1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9TY2FsZUNvbnRyb2xPcHRpb25zKG9wdGlvbnM6IFNjYWxlQ29udHJvbE9wdGlvbnMpOiBCU2NhbGVDb250cm9sT3B0aW9ucyB7XHJcbiAgY29uc3Qgb3B0czogQlNjYWxlQ29udHJvbE9wdGlvbnMgPSB7fVxyXG5cclxuICBpZiAoIW9wdGlvbnMpIHtcclxuICAgIHJldHVybiBvcHRzXHJcbiAgfVxyXG5cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLmFuY2hvcikpIHtcclxuICAgIG9wdHMuYW5jaG9yID0gb3B0aW9ucy5hbmNob3JcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5vZmZzZXQpKSB7XHJcbiAgICBvcHRzLm9mZnNldCA9IHRvU2l6ZShvcHRpb25zLm9mZnNldClcclxuICB9XHJcbiAgcmV0dXJuIG9wdHNcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvTWFwVHlwZUNvbnRyb2xPcHRpb25zKG9wdGlvbnM6IE1hcFR5cGVDb250cm9sT3B0aW9ucyk6IEJNYXBUeXBlQ29udHJvbE9wdGlvbnMge1xyXG4gIGNvbnN0IG9wdHM6IEJNYXBUeXBlQ29udHJvbE9wdGlvbnMgPSB7fVxyXG5cclxuICBpZiAoIW9wdGlvbnMpIHtcclxuICAgIHJldHVybiBvcHRzXHJcbiAgfVxyXG5cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLnR5cGUpKSB7XHJcbiAgICBvcHRzLnR5cGUgPSBvcHRpb25zLnR5cGVcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5tYXBUeXBlcykpIHtcclxuICAgIG9wdHMubWFwVHlwZXMgPSBvcHRpb25zLm1hcFR5cGVzLm1hcChtYXBUeXBlID0+IHtcclxuICAgICAgcmV0dXJuIGlzTWFwVHlwZUVudW0obWFwVHlwZSkgPyB3aW5kb3dbbWFwVHlwZV0gOiBtYXBUeXBlXHJcbiAgICB9KVxyXG4gIH1cclxuICByZXR1cm4gb3B0c1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9HZW9sb2NhdGlvbk9wdGlvbnMob3B0aW9uczogR2VvbG9jYXRpb25Db250cm9sT3B0aW9ucyk6IEJHZW9sb2NhdGlvbkNvbnRyb2xPcHRpb25zIHtcclxuICBjb25zdCBvcHRzOiBCR2VvbG9jYXRpb25Db250cm9sT3B0aW9ucyA9IHt9XHJcblxyXG4gIGlmICghb3B0aW9ucykge1xyXG4gICAgcmV0dXJuIG9wdHNcclxuICB9XHJcblxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMuYW5jaG9yKSkge1xyXG4gICAgb3B0cy5hbmNob3IgPSBvcHRpb25zLmFuY2hvclxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLm9mZnNldCkpIHtcclxuICAgIG9wdHMub2Zmc2V0ID0gdG9TaXplKG9wdGlvbnMub2Zmc2V0KVxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLmVuYWJsZUF1dG9Mb2NhdGlvbikpIHtcclxuICAgIG9wdHMuZW5hYmxlQXV0b0xvY2F0aW9uID0gb3B0aW9ucy5lbmFibGVBdXRvTG9jYXRpb25cclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5sb2NhdGlvbkljb24pKSB7XHJcbiAgICBvcHRzLmxvY2F0aW9uSWNvbiA9IHRvSWNvbihvcHRpb25zLmxvY2F0aW9uSWNvbi5pbWFnZVVybCwgb3B0aW9ucy5sb2NhdGlvbkljb24uc2l6ZSwgb3B0aW9ucy5sb2NhdGlvbkljb24pXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMuc2hvd0FkZHJlc3NCYXIpKSB7XHJcbiAgICBvcHRzLnNob3dBZGRyZXNzQmFyID0gb3B0aW9ucy5zaG93QWRkcmVzc0JhclxyXG4gIH1cclxuICByZXR1cm4gb3B0c1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9UZXh0SWNvblN0eWxlKHN0eWxlOiBUZXh0SWNvblN0eWxlKTogQlRleHRJY29uU3R5bGUge1xyXG4gIGNvbnN0IHJlYWxTdHlsZTogQlRleHRJY29uU3R5bGUgPSB7XHJcbiAgICB1cmw6IHN0eWxlLnVybCxcclxuICAgIHNpemU6IHRvU2l6ZShzdHlsZS5zaXplKVxyXG4gIH1cclxuICBpZiAoc3R5bGUuYW5jaG9yKSB7XHJcbiAgICByZWFsU3R5bGUuYW5jaG9yID0gdG9TaXplKHN0eWxlLmFuY2hvcilcclxuICB9XHJcbiAgaWYgKHN0eWxlLm9mZnNldCkge1xyXG4gICAgcmVhbFN0eWxlLm9mZnNldCA9IHRvU2l6ZShzdHlsZS5vZmZzZXQpXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKHN0eWxlLnRleHRTaXplKSkge1xyXG4gICAgcmVhbFN0eWxlLnRleHRTaXplID0gc3R5bGUudGV4dFNpemVcclxuICB9XHJcbiAgaWYgKCFpc051bGwoc3R5bGUudGV4dENvbG9yKSkge1xyXG4gICAgcmVhbFN0eWxlLnRleHRDb2xvciA9IHN0eWxlLnRleHRDb2xvclxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlYWxTdHlsZVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9NYXJrZXJDbHVzdGVyZXJPcHRpb25zKG9wdGlvbnM6IE1hcmtlckNsdXN0ZXJlck9wdGlvbnMpOiBCTWFya2VyQ2x1c3RlcmVyT3B0aW9ucyB7XHJcbiAgY29uc3Qgb3B0czogQk1hcmtlckNsdXN0ZXJlck9wdGlvbnMgPSB7fVxyXG5cclxuICBpZiAoIW9wdGlvbnMpIHtcclxuICAgIHJldHVybiBvcHRzXHJcbiAgfVxyXG5cclxuICBpZiAob3B0aW9ucy5tYXJrZXJzKSB7XHJcbiAgICBvcHRzLm1hcmtlcnMgPSBvcHRpb25zLm1hcmtlcnMubWFwKFxyXG4gICAgICBtID0+IG5ldyB3aW5kb3cuQk1hcC5NYXJrZXIodG9Qb2ludChtLnBvaW50KSwgdG9NYXJrZXJPcHRpb25zKG0ub3B0aW9ucykpXHJcbiAgICApXHJcbiAgfVxyXG5cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLmdpcmRTaXplKSkge1xyXG4gICAgb3B0cy5naXJkU2l6ZSA9IG9wdGlvbnMuZ2lyZFNpemVcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5tYXhab29tKSkge1xyXG4gICAgb3B0cy5tYXhab29tID0gb3B0aW9ucy5tYXhab29tXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMubWluQ2x1c3RlclNpemUpKSB7XHJcbiAgICBvcHRzLm1pbkNsdXN0ZXJTaXplID0gb3B0aW9ucy5taW5DbHVzdGVyU2l6ZVxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLmlzQXZlcmFuZ2VDZW50ZXIpKSB7XHJcbiAgICBvcHRzLmlzQXZlcmFuZ2VDZW50ZXIgPSBvcHRpb25zLmlzQXZlcmFuZ2VDZW50ZXJcclxuICB9XHJcbiAgaWYgKG9wdGlvbnMuc3R5bGVzKSB7XHJcbiAgICBvcHRzLnN0eWxlcyA9IG9wdGlvbnMuc3R5bGVzLmZpbHRlcihzID0+IHMpLm1hcChzID0+IHRvVGV4dEljb25TdHlsZShzKSlcclxuICB9XHJcblxyXG4gIHJldHVybiBvcHRzXHJcbn1cclxuIl19