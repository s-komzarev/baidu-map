import { isMapTypeEnum } from '../types/Map';
import { isNull } from './object';
export function toPoint(opts) {
    if (!opts) {
        return new window.BMap.Point();
    }
    return new window.BMap.Point(opts.lng, opts.lat);
}
export function toPoints(opts) {
    if (!opts) {
        return [];
    }
    return opts.map(p => {
        return new window.BMap.Point(p.lng, p.lat);
    });
}
export function toSize(opts) {
    if (!opts) {
        return new window.BMap.Size();
    }
    return new window.BMap.Size(opts.width, opts.height);
}
export function toIcon(url, size, options) {
    if (!size && !options) {
        return new window.BMap.Icon(url);
    }
    if (!size) {
        return new window.BMap.Icon(url, toSize(size));
    }
    const iconOptions = {
        anchor: toSize(options.anchor),
        imageOffset: toSize(options.imageOffset),
        infoWindowAnchor: toSize(options.infoWindowAnchor),
        printImageUrl: options.printImageUrl
    };
    const icon = new window.BMap.Icon(url, toSize(size), iconOptions);
    if (options.imageSize) {
        icon.setImageSize(toSize(options.imageSize));
    }
    return icon;
}
export function toMarkerOptions(options) {
    const opts = {};
    if (!options) {
        return opts;
    }
    if (options.offset) {
        opts.offset = toSize(options.offset);
    }
    if (options.icon) {
        opts.icon = toIcon(options.icon.imageUrl, options.icon.size, options.icon);
    }
    if (!isNull(options.enableMassClear)) {
        opts.enableMassClear = options.enableMassClear;
    }
    if (!isNull(options.enableDragging)) {
        opts.enableDragging = options.enableDragging;
    }
    if (!isNull(options.enableClicking)) {
        opts.enableClicking = options.enableClicking;
    }
    if (!isNull(options.raiseOnDrag)) {
        opts.raiseOnDrag = options.raiseOnDrag;
    }
    if (!isNull(options.draggingCursor)) {
        opts.draggingCursor = options.draggingCursor;
    }
    if (!isNull(options.rotation)) {
        opts.rotation = options.rotation;
    }
    if (!isNull(options.title)) {
        opts.title = options.title;
    }
    if (!isNull(options.shadow)) {
        opts.shadow = toIcon(options.shadow.imageUrl, options.shadow.size, options.shadow);
    }
    return opts;
}
export function toNavigationControlOptions(options) {
    const opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.enableGeolocation)) {
        opts.enableGeolocation = options.enableGeolocation;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    if (!isNull(options.showZoomInfo)) {
        opts.showZoomInfo = options.showZoomInfo;
    }
    if (!isNull(options.type)) {
        opts.type = options.type;
    }
    return opts;
}
export function toOverviewMapControlOptions(options) {
    const opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.isOpen)) {
        opts.isOpen = options.isOpen;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    if (!isNull(options.size)) {
        opts.size = toSize(options.size);
    }
    return opts;
}
export function toScaleControlOptions(options) {
    const opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    return opts;
}
export function toMapTypeControlOptions(options) {
    const opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.type)) {
        opts.type = options.type;
    }
    if (!isNull(options.mapTypes)) {
        opts.mapTypes = options.mapTypes.map(mapType => {
            return isMapTypeEnum(mapType) ? window[mapType] : mapType;
        });
    }
    return opts;
}
export function toGeolocationOptions(options) {
    const opts = {};
    if (!options) {
        return opts;
    }
    if (!isNull(options.anchor)) {
        opts.anchor = options.anchor;
    }
    if (!isNull(options.offset)) {
        opts.offset = toSize(options.offset);
    }
    if (!isNull(options.enableAutoLocation)) {
        opts.enableAutoLocation = options.enableAutoLocation;
    }
    if (!isNull(options.locationIcon)) {
        opts.locationIcon = toIcon(options.locationIcon.imageUrl, options.locationIcon.size, options.locationIcon);
    }
    if (!isNull(options.showAddressBar)) {
        opts.showAddressBar = options.showAddressBar;
    }
    return opts;
}
export function toTextIconStyle(style) {
    const realStyle = {
        url: style.url,
        size: toSize(style.size)
    };
    if (style.anchor) {
        realStyle.anchor = toSize(style.anchor);
    }
    if (style.offset) {
        realStyle.offset = toSize(style.offset);
    }
    if (!isNull(style.textSize)) {
        realStyle.textSize = style.textSize;
    }
    if (!isNull(style.textColor)) {
        realStyle.textColor = style.textColor;
    }
    return realStyle;
}
export function toMarkerClustererOptions(options) {
    const opts = {};
    if (!options) {
        return opts;
    }
    if (options.markers) {
        opts.markers = options.markers.map(m => new window.BMap.Marker(toPoint(m.point), toMarkerOptions(m.options)));
    }
    if (!isNull(options.girdSize)) {
        opts.girdSize = options.girdSize;
    }
    if (!isNull(options.maxZoom)) {
        opts.maxZoom = options.maxZoom;
    }
    if (!isNull(options.minClusterSize)) {
        opts.minClusterSize = options.minClusterSize;
    }
    if (!isNull(options.isAverangeCenter)) {
        opts.isAverangeCenter = options.isAverangeCenter;
    }
    if (options.styles) {
        opts.styles = options.styles.filter(s => s).map(s => toTextIconStyle(s));
    }
    return opts;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyMi1iYWlkdS1tYXAvIiwic291cmNlcyI6WyJsaWIvaGVscGVycy90cmFuc2Zvcm1lci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFnQkEsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGNBQWMsQ0FBQTtBQUU1QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBSWpDLE1BQU0sVUFBVSxPQUFPLENBQUMsSUFBVztJQUNqQyxJQUFJLENBQUMsSUFBSSxFQUFFO1FBQ1QsT0FBTyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUE7S0FDL0I7SUFDRCxPQUFPLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDbEQsQ0FBQztBQUVELE1BQU0sVUFBVSxRQUFRLENBQUMsSUFBa0I7SUFDekMsSUFBSSxDQUFDLElBQUksRUFBRTtRQUNULE9BQU8sRUFBRSxDQUFBO0tBQ1Y7SUFDRCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUU7UUFDbEIsT0FBTyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQzVDLENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxNQUFNLENBQUMsSUFBVTtJQUMvQixJQUFJLENBQUMsSUFBSSxFQUFFO1FBQ1QsT0FBTyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUE7S0FDOUI7SUFDRCxPQUFPLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7QUFDdEQsQ0FBQztB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QyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtLQUN6RTtJQUVELE9BQU8sSUFBSSxDQUFBO0FBQ2IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQkdlb2xvY2F0aW9uQ29udHJvbE9wdGlvbnMsXHJcbiAgQk1hcFR5cGVDb250cm9sT3B0aW9ucyxcclxuICBCTmF2aWdhdGlvbkNvbnRyb2xPcHRpb25zLFxyXG4gIEJPdmVydmlld01hcENvbnRyb2xPcHRpb25zLFxyXG4gIEJTY2FsZUNvbnRyb2xPcHRpb25zLFxyXG4gIEdlb2xvY2F0aW9uQ29udHJvbE9wdGlvbnMsXHJcbiAgTWFwVHlwZUNvbnRyb2xPcHRpb25zLFxyXG4gIE5hdmlnYXRpb25Db250cm9sT3B0aW9ucyxcclxuICBPdmVydmlld01hcENvbnRyb2xPcHRpb25zLFxyXG4gIFNjYWxlQ29udHJvbE9wdGlvbnNcclxufSBmcm9tICcuLi90eXBlcy9Db250cm9sJ1xyXG5pbXBvcnQgeyBCSWNvbiwgSWNvbk9wdGlvbnMgfSBmcm9tICcuLi90eXBlcy9JY29uJ1xyXG5pbXBvcnQgeyBCTWFya2VyT3B0aW9ucywgTWFya2VyT3B0aW9ucyB9IGZyb20gJy4uL3R5cGVzL01hcmtlcidcclxuaW1wb3J0IHsgQlBvaW50LCBQb2ludCB9IGZyb20gJy4uL3R5cGVzL1BvaW50J1xyXG5pbXBvcnQgeyBCU2l6ZSwgU2l6ZSB9IGZyb20gJy4uL3R5cGVzL1NpemUnXHJcbmltcG9ydCB7IGlzTWFwVHlwZUVudW0gfSBmcm9tICcuLi90eXBlcy9NYXAnXHJcblxyXG5pbXBvcnQgeyBpc051bGwgfSBmcm9tICcuL29iamVjdCdcclxuaW1wb3J0IHsgQk1hcmtlckNsdXN0ZXJlck9wdGlvbnMsIE1hcmtlckNsdXN0ZXJlck9wdGlvbnMgfSBmcm9tICcuLi90eXBlcy9NYXJrZXJDbHVzdGVyZXInXHJcbmltcG9ydCB7IFRleHRJY29uU3R5bGUsIEJUZXh0SWNvblN0eWxlIH0gZnJvbSAnLi4vdHlwZXMvVGV4dEljb25PdmVybGF5J1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvUG9pbnQob3B0czogUG9pbnQpOiBCUG9pbnQge1xyXG4gIGlmICghb3B0cykge1xyXG4gICAgcmV0dXJuIG5ldyB3aW5kb3cuQk1hcC5Qb2ludCgpXHJcbiAgfVxyXG4gIHJldHVybiBuZXcgd2luZG93LkJNYXAuUG9pbnQob3B0cy5sbmcsIG9wdHMubGF0KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9Qb2ludHMob3B0czogQXJyYXk8UG9pbnQ+KTogQXJyYXk8QlBvaW50PiB7XHJcbiAgaWYgKCFvcHRzKSB7XHJcbiAgICByZXR1cm4gW11cclxuICB9XHJcbiAgcmV0dXJuIG9wdHMubWFwKHAgPT4ge1xyXG4gICAgcmV0dXJuIG5ldyB3aW5kb3cuQk1hcC5Qb2ludChwLmxuZywgcC5sYXQpXHJcbiAgfSlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvU2l6ZShvcHRzOiBTaXplKTogQlNpemUge1xyXG4gIGlmICghb3B0cykge1xyXG4gICAgcmV0dXJuIG5ldyB3aW5kb3cuQk1hcC5TaXplKClcclxuICB9XHJcbiAgcmV0dXJuIG5ldyB3aW5kb3cuQk1hcC5TaXplKG9wdHMud2lkdGgsIG9wdHMuaGVpZ2h0KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9JY29uKHVybDogc3RyaW5nLCBzaXplOiBTaXplLCBvcHRpb25zOiBJY29uT3B0aW9ucyk6IEJJY29uIHtcclxuICBpZiAoIXNpemUgJiYgIW9wdGlvbnMpIHtcclxuICAgIHJldHVybiBuZXcgd2luZG93LkJNYXAuSWNvbih1cmwpXHJcbiAgfVxyXG4gIGlmICghc2l6ZSkge1xyXG4gICAgcmV0dXJuIG5ldyB3aW5kb3cuQk1hcC5JY29uKHVybCwgdG9TaXplKHNpemUpKVxyXG4gIH1cclxuICBjb25zdCBpY29uT3B0aW9uczogYW55ID0ge1xyXG4gICAgYW5jaG9yOiB0b1NpemUob3B0aW9ucy5hbmNob3IpLFxyXG4gICAgaW1hZ2VPZmZzZXQ6IHRvU2l6ZShvcHRpb25zLmltYWdlT2Zmc2V0KSxcclxuICAgIGluZm9XaW5kb3dBbmNob3I6IHRvU2l6ZShvcHRpb25zLmluZm9XaW5kb3dBbmNob3IpLFxyXG4gICAgcHJpbnRJbWFnZVVybDogb3B0aW9ucy5wcmludEltYWdlVXJsXHJcbiAgfVxyXG4gIGNvbnN0IGljb24gPSBuZXcgd2luZG93LkJNYXAuSWNvbih1cmwsIHRvU2l6ZShzaXplKSwgaWNvbk9wdGlvbnMpXHJcbiAgaWYgKG9wdGlvbnMuaW1hZ2VTaXplKSB7XHJcbiAgICBpY29uLnNldEltYWdlU2l6ZSh0b1NpemUob3B0aW9ucy5pbWFnZVNpemUpKVxyXG4gIH1cclxuICByZXR1cm4gaWNvblxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9NYXJrZXJPcHRpb25zKG9wdGlvbnM6IE1hcmtlck9wdGlvbnMpOiBCTWFya2VyT3B0aW9ucyB7XHJcbiAgY29uc3Qgb3B0czogQk1hcmtlck9wdGlvbnMgPSB7fVxyXG5cclxuICBpZiAoIW9wdGlvbnMpIHtcclxuICAgIHJldHVybiBvcHRzXHJcbiAgfVxyXG5cclxuICBpZiAob3B0aW9ucy5vZmZzZXQpIHtcclxuICAgIG9wdHMub2Zmc2V0ID0gdG9TaXplKG9wdGlvbnMub2Zmc2V0KVxyXG4gIH1cclxuXHJcbiAgaWYgKG9wdGlvbnMuaWNvbikge1xyXG4gICAgb3B0cy5pY29uID0gdG9JY29uKG9wdGlvbnMuaWNvbi5pbWFnZVVybCwgb3B0aW9ucy5pY29uLnNpemUsIG9wdGlvbnMuaWNvbilcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5lbmFibGVNYXNzQ2xlYXIpKSB7XHJcbiAgICBvcHRzLmVuYWJsZU1hc3NDbGVhciA9IG9wdGlvbnMuZW5hYmxlTWFzc0NsZWFyXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMuZW5hYmxlRHJhZ2dpbmcpKSB7XHJcbiAgICBvcHRzLmVuYWJsZURyYWdnaW5nID0gb3B0aW9ucy5lbmFibGVEcmFnZ2luZ1xyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLmVuYWJsZUNsaWNraW5nKSkge1xyXG4gICAgb3B0cy5lbmFibGVDbGlja2luZyA9IG9wdGlvbnMuZW5hYmxlQ2xpY2tpbmdcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5yYWlzZU9uRHJhZykpIHtcclxuICAgIG9wdHMucmFpc2VPbkRyYWcgPSBvcHRpb25zLnJhaXNlT25EcmFnXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMuZHJhZ2dpbmdDdXJzb3IpKSB7XHJcbiAgICBvcHRzLmRyYWdnaW5nQ3Vyc29yID0gb3B0aW9ucy5kcmFnZ2luZ0N1cnNvclxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLnJvdGF0aW9uKSkge1xyXG4gICAgb3B0cy5yb3RhdGlvbiA9IG9wdGlvbnMucm90YXRpb25cclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy50aXRsZSkpIHtcclxuICAgIG9wdHMudGl0bGUgPSBvcHRpb25zLnRpdGxlXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMuc2hhZG93KSkge1xyXG4gICAgb3B0cy5zaGFkb3cgPSB0b0ljb24ob3B0aW9ucy5zaGFkb3cuaW1hZ2VVcmwsIG9wdGlvbnMuc2hhZG93LnNpemUsIG9wdGlvbnMuc2hhZG93KVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG9wdHNcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvTmF2aWdhdGlvbkNvbnRyb2xPcHRpb25zKG9wdGlvbnM6IE5hdmlnYXRpb25Db250cm9sT3B0aW9ucyk6IEJOYXZpZ2F0aW9uQ29udHJvbE9wdGlvbnMge1xyXG4gIGNvbnN0IG9wdHM6IEJOYXZpZ2F0aW9uQ29udHJvbE9wdGlvbnMgPSB7fVxyXG5cclxuICBpZiAoIW9wdGlvbnMpIHtcclxuICAgIHJldHVybiBvcHRzXHJcbiAgfVxyXG5cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLmFuY2hvcikpIHtcclxuICAgIG9wdHMuYW5jaG9yID0gb3B0aW9ucy5hbmNob3JcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5lbmFibGVHZW9sb2NhdGlvbikpIHtcclxuICAgIG9wdHMuZW5hYmxlR2VvbG9jYXRpb24gPSBvcHRpb25zLmVuYWJsZUdlb2xvY2F0aW9uXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMub2Zmc2V0KSkge1xyXG4gICAgb3B0cy5vZmZzZXQgPSB0b1NpemUob3B0aW9ucy5vZmZzZXQpXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMuc2hvd1pvb21JbmZvKSkge1xyXG4gICAgb3B0cy5zaG93Wm9vbUluZm8gPSBvcHRpb25zLnNob3dab29tSW5mb1xyXG4gIH1cclxuXHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy50eXBlKSkge1xyXG4gICAgb3B0cy50eXBlID0gb3B0aW9ucy50eXBlXHJcbiAgfVxyXG4gIHJldHVybiBvcHRzXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b092ZXJ2aWV3TWFwQ29udHJvbE9wdGlvbnMob3B0aW9uczogT3ZlcnZpZXdNYXBDb250cm9sT3B0aW9ucyk6IEJPdmVydmlld01hcENvbnRyb2xPcHRpb25zIHtcclxuICBjb25zdCBvcHRzOiBCT3ZlcnZpZXdNYXBDb250cm9sT3B0aW9ucyA9IHt9XHJcblxyXG4gIGlmICghb3B0aW9ucykge1xyXG4gICAgcmV0dXJuIG9wdHNcclxuICB9XHJcblxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMuYW5jaG9yKSkge1xyXG4gICAgb3B0cy5hbmNob3IgPSBvcHRpb25zLmFuY2hvclxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLmlzT3BlbikpIHtcclxuICAgIG9wdHMuaXNPcGVuID0gb3B0aW9ucy5pc09wZW5cclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5vZmZzZXQpKSB7XHJcbiAgICBvcHRzLm9mZnNldCA9IHRvU2l6ZShvcHRpb25zLm9mZnNldClcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5zaXplKSkge1xyXG4gICAgb3B0cy5zaXplID0gdG9TaXplKG9wdGlvbnMuc2l6ZSlcclxuICB9XHJcbiAgcmV0dXJuIG9wdHNcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvU2NhbGVDb250cm9sT3B0aW9ucyhvcHRpb25zOiBTY2FsZUNvbnRyb2xPcHRpb25zKTogQlNjYWxlQ29udHJvbE9wdGlvbnMge1xyXG4gIGNvbnN0IG9wdHM6IEJTY2FsZUNvbnRyb2xPcHRpb25zID0ge31cclxuXHJcbiAgaWYgKCFvcHRpb25zKSB7XHJcbiAgICByZXR1cm4gb3B0c1xyXG4gIH1cclxuXHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5hbmNob3IpKSB7XHJcbiAgICBvcHRzLmFuY2hvciA9IG9wdGlvbnMuYW5jaG9yXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMub2Zmc2V0KSkge1xyXG4gICAgb3B0cy5vZmZzZXQgPSB0b1NpemUob3B0aW9ucy5vZmZzZXQpXHJcbiAgfVxyXG4gIHJldHVybiBvcHRzXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b01hcFR5cGVDb250cm9sT3B0aW9ucyhvcHRpb25zOiBNYXBUeXBlQ29udHJvbE9wdGlvbnMpOiBCTWFwVHlwZUNvbnRyb2xPcHRpb25zIHtcclxuICBjb25zdCBvcHRzOiBCTWFwVHlwZUNvbnRyb2xPcHRpb25zID0ge31cclxuXHJcbiAgaWYgKCFvcHRpb25zKSB7XHJcbiAgICByZXR1cm4gb3B0c1xyXG4gIH1cclxuXHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy50eXBlKSkge1xyXG4gICAgb3B0cy50eXBlID0gb3B0aW9ucy50eXBlXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMubWFwVHlwZXMpKSB7XHJcbiAgICBvcHRzLm1hcFR5cGVzID0gb3B0aW9ucy5tYXBUeXBlcy5tYXAobWFwVHlwZSA9PiB7XHJcbiAgICAgIHJldHVybiBpc01hcFR5cGVFbnVtKG1hcFR5cGUpID8gd2luZG93W21hcFR5cGVdIDogbWFwVHlwZVxyXG4gICAgfSlcclxuICB9XHJcbiAgcmV0dXJuIG9wdHNcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvR2VvbG9jYXRpb25PcHRpb25zKG9wdGlvbnM6IEdlb2xvY2F0aW9uQ29udHJvbE9wdGlvbnMpOiBCR2VvbG9jYXRpb25Db250cm9sT3B0aW9ucyB7XHJcbiAgY29uc3Qgb3B0czogQkdlb2xvY2F0aW9uQ29udHJvbE9wdGlvbnMgPSB7fVxyXG5cclxuICBpZiAoIW9wdGlvbnMpIHtcclxuICAgIHJldHVybiBvcHRzXHJcbiAgfVxyXG5cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLmFuY2hvcikpIHtcclxuICAgIG9wdHMuYW5jaG9yID0gb3B0aW9ucy5hbmNob3JcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5vZmZzZXQpKSB7XHJcbiAgICBvcHRzLm9mZnNldCA9IHRvU2l6ZShvcHRpb25zLm9mZnNldClcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5lbmFibGVBdXRvTG9jYXRpb24pKSB7XHJcbiAgICBvcHRzLmVuYWJsZUF1dG9Mb2NhdGlvbiA9IG9wdGlvbnMuZW5hYmxlQXV0b0xvY2F0aW9uXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMubG9jYXRpb25JY29uKSkge1xyXG4gICAgb3B0cy5sb2NhdGlvbkljb24gPSB0b0ljb24ob3B0aW9ucy5sb2NhdGlvbkljb24uaW1hZ2VVcmwsIG9wdGlvbnMubG9jYXRpb25JY29uLnNpemUsIG9wdGlvbnMubG9jYXRpb25JY29uKVxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLnNob3dBZGRyZXNzQmFyKSkge1xyXG4gICAgb3B0cy5zaG93QWRkcmVzc0JhciA9IG9wdGlvbnMuc2hvd0FkZHJlc3NCYXJcclxuICB9XHJcbiAgcmV0dXJuIG9wdHNcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvVGV4dEljb25TdHlsZShzdHlsZTogVGV4dEljb25TdHlsZSk6IEJUZXh0SWNvblN0eWxlIHtcclxuICBjb25zdCByZWFsU3R5bGU6IEJUZXh0SWNvblN0eWxlID0ge1xyXG4gICAgdXJsOiBzdHlsZS51cmwsXHJcbiAgICBzaXplOiB0b1NpemUoc3R5bGUuc2l6ZSlcclxuICB9XHJcbiAgaWYgKHN0eWxlLmFuY2hvcikge1xyXG4gICAgcmVhbFN0eWxlLmFuY2hvciA9IHRvU2l6ZShzdHlsZS5hbmNob3IpXHJcbiAgfVxyXG4gIGlmIChzdHlsZS5vZmZzZXQpIHtcclxuICAgIHJlYWxTdHlsZS5vZmZzZXQgPSB0b1NpemUoc3R5bGUub2Zmc2V0KVxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChzdHlsZS50ZXh0U2l6ZSkpIHtcclxuICAgIHJlYWxTdHlsZS50ZXh0U2l6ZSA9IHN0eWxlLnRleHRTaXplXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKHN0eWxlLnRleHRDb2xvcikpIHtcclxuICAgIHJlYWxTdHlsZS50ZXh0Q29sb3IgPSBzdHlsZS50ZXh0Q29sb3JcclxuICB9XHJcblxyXG4gIHJldHVybiByZWFsU3R5bGVcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvTWFya2VyQ2x1c3RlcmVyT3B0aW9ucyhvcHRpb25zOiBNYXJrZXJDbHVzdGVyZXJPcHRpb25zKTogQk1hcmtlckNsdXN0ZXJlck9wdGlvbnMge1xyXG4gIGNvbnN0IG9wdHM6IEJNYXJrZXJDbHVzdGVyZXJPcHRpb25zID0ge31cclxuXHJcbiAgaWYgKCFvcHRpb25zKSB7XHJcbiAgICByZXR1cm4gb3B0c1xyXG4gIH1cclxuXHJcbiAgaWYgKG9wdGlvbnMubWFya2Vycykge1xyXG4gICAgb3B0cy5tYXJrZXJzID0gb3B0aW9ucy5tYXJrZXJzLm1hcChcclxuICAgICAgbSA9PiBuZXcgd2luZG93LkJNYXAuTWFya2VyKHRvUG9pbnQobS5wb2ludCksIHRvTWFya2VyT3B0aW9ucyhtLm9wdGlvbnMpKVxyXG4gICAgKVxyXG4gIH1cclxuXHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5naXJkU2l6ZSkpIHtcclxuICAgIG9wdHMuZ2lyZFNpemUgPSBvcHRpb25zLmdpcmRTaXplXHJcbiAgfVxyXG4gIGlmICghaXNOdWxsKG9wdGlvbnMubWF4Wm9vbSkpIHtcclxuICAgIG9wdHMubWF4Wm9vbSA9IG9wdGlvbnMubWF4Wm9vbVxyXG4gIH1cclxuICBpZiAoIWlzTnVsbChvcHRpb25zLm1pbkNsdXN0ZXJTaXplKSkge1xyXG4gICAgb3B0cy5taW5DbHVzdGVyU2l6ZSA9IG9wdGlvbnMubWluQ2x1c3RlclNpemVcclxuICB9XHJcbiAgaWYgKCFpc051bGwob3B0aW9ucy5pc0F2ZXJhbmdlQ2VudGVyKSkge1xyXG4gICAgb3B0cy5pc0F2ZXJhbmdlQ2VudGVyID0gb3B0aW9ucy5pc0F2ZXJhbmdlQ2VudGVyXHJcbiAgfVxyXG4gIGlmIChvcHRpb25zLnN0eWxlcykge1xyXG4gICAgb3B0cy5zdHlsZXMgPSBvcHRpb25zLnN0eWxlcy5maWx0ZXIocyA9PiBzKS5tYXAocyA9PiB0b1RleHRJY29uU3R5bGUocykpXHJcbiAgfVxyXG5cclxuICByZXR1cm4gb3B0c1xyXG59XHJcbiJdfQ==